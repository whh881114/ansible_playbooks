---
- name: update kernel
  yum:
    name: "kernel-ml-{{ kubernetes_kernel_version }}"
    state: present

- name: set default boot kernel to kernel-ml-{{ kubernetes_kernel_version }}
  shell: |
    grub2-set-default 0

- name: install k8s packages
  yum:
    name: "{{ packages }}"
    state: present
  vars:
    packages: "{{ kubernetes_pkgs }}"
  notify: restart-kubelet

# 当使用calico网络插件时需要配置此项，其他的暂时没有提到，所以可以默认就安装。
- name: configure NetworkManager
  template:
    src: calico.conf.j2
    dest: /etc/NetworkManager/conf.d/calico.conf
  notify: restart-NetworkManager